<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>CC - Technology</title>
  </head>

  <body>
    <div>
      <label>Name</label>
      <input id="name" name="a" type="text" /><br />
      <label>Comment</label>
      <input id="comment" name="b" type="text" /><br />
      <input id="imageUploader" type="file" name="image" />
    </div>
    <ul id="messages"></ul>

    <script>
      let userName = window.localStorage.getItem("name");
      let socket = io();
      let clientSessionID = "";
      let isMessageSentByCurrentUser = false;
      const roomName = "technologyRoom";

      // set clientSessionID once client is connected
      socket.on("connect", () => {
        clientSessionID = socket.id;
        // join room technology
        socket.emit("joinRoom", roomName);
      });

      //Get message from server.
      socket.on("message", function (username, data) {
        console.log("commented " + data);
        // display message using localStorage for name
        let userName = window.localStorage.getItem("name");
        $("#messages").append(
          `<li> ${userName ? userName : "Anonymous"}: ${data.comment}</li>`
        );
        // in old code just remember the data passed in has a .name property
      });

      socket.on("connectToRoom", function (data) {
        // log out the client side session ID
        console.log(clientSessionID);
        // send different global messages depending on if the client is seeing it or others are seeing it
        if (data.serverSessionID == clientSessionID) {
          $("#messages").append("<li>You have " + data.message + "</li>");
        } else {
          $("#messages").append(
            `<li>${data.username} has ${data.message}</li>`
          );
        }
      });

      function Clicked() {
        socket.emit("message", {
          name: $("#name").val(),
          comment: $("#comment").val(),
          image: $("#imageUploader"),
          // FIX image path, for now we just have a image property
        });
        return false;
      }

      $(document).ready(function () {
        console.log("ready");
        $("#name").keydown(function (event) {
          if (event.which === 13) {
            Clicked();
            event.preventDefault();
            return false;
          }
        });
        $("#comment").keydown(function (event) {
          if (event.which === 13) {
            Clicked();
            $("#comment").val("");
            event.preventDefault();
            return false;
          }
        });
      });
    </script>
  </body>
</html>
